#!/usr/bin/coffee
program = require "commander"
fs = require "fs"
xml2js = require "xml2js"

input_file = null
output_file = null

program
  .arguments("<input_file> <output_file>")
  .option("--to_xml", "convert to xml")
  .option("--to_json", "convert to json")
  .description("convert between xml and json using xml2js")
  .action (a, b) ->
    input_file = a
    output_file = b
  .parse process.argv

if input_file && output_file
  file_content = fs.readFileSync input_file
  if program.to_json
    xml2js.parseString file_content, (err, result) ->
      fs.writeFileSync output_file, JSON.stringify(result, null, 2)
  else if program.to_xml
    builder = new xml2js.Builder
    xml = builder.buildObject JSON.parse file_content
    fs.writeFileSync output_file, xml
